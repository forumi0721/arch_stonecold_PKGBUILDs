# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

_pkgbase="x-tools"
pkgname=("${_pkgbase}-armv5" "${_pkgbase}-armv6h" "${_pkgbase}-armv7h")
pkgver=5.1.0
pkgrel=1
pkgdesc="An x-tools package for Arch Linux ARM"
arch=("x86_64")
url="http://archlinuxarm.org/developers/distcc-cross-compiling"
license=("GPL" )
options=("libtool" "emptydirs" "!strip")
source=(
	"alarm-x-tools5.tar.xz::http://archlinuxarm.org/builder/xtools/x-tools.tar.xz"
	"alarm-x-tools6.tar.xz::http://archlinuxarm.org/builder/xtools/x-tools6h.tar.xz"
	"alarm-x-tools7.tar.xz::http://archlinuxarm.org/builder/xtools/x-tools7h.tar.xz"
	"${_pkgbase}.tar.xz"
)
md5sums=(
	"fb4c6977190b3a1d9d39d59f2cb69ed4"
	"74ab3f88c0d09c67f047532f48116e2f"
	"b8e2c1056705cf27332022a02fd6b976"
	"817d78b216b3ce5046eae338de669a15"
)

package_x-tools-armv5() {
	install -dm755 "${pkgdir}/opt"
	cp -ar "${srcdir}/x-tools/arm-unknown-linux-gnueabi" "${pkgdir}/opt/alarm-x-tools-armv5"

	rm -rf "${pkgdir}/opt/alarm-x-tools-armv5/build.log.bz2"

	cd "${pkgdir}/opt/alarm-x-tools-armv5/bin"
	for f in $(ls --ignore=arm-unknown-linux-gnueabi-*)
	do
		rm "${f}"
	done
	for f in $(ls arm-unknown-linux-gnueabi-*)
	do
		mv "${f}" "$(echo "${f}" | sed "s/^arm/armv5tel/g")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	for f in *
	do
		ln -s "/opt/alarm-x-tools-armv5/bin/$(basename "${f}")" "${pkgdir}/usr/bin/$(basename "${f}")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	install -Dm755 "${srcdir}/bin/xmake-armv5" "${pkgdir}/usr/bin/"
	ln -s "xmake-armv5" "${srcdir}/bin/make-armv5"

	install -dm755 "${pkgdir}/usr/share/bash-completion/completions"
	install -Dm644 "${srcdir}/completions/xmake-armv5" "${pkgdir}/usr/share/bash-completion/completions/"

	#for qemu
	install -dm755 "${pkgdir}/etc/qemu-binfmt"
	ln -s "/opt/alarm-x-tools-armv5/arm-unknown-linux-gnueabi/sysroot" "${pkgdir}/etc/qemu-binfmt/arm"
}

package_x-tools-armv6h() {
	install -dm755 "${pkgdir}/opt"
	cp -ar "${srcdir}/x-tools6h/arm-unknown-linux-gnueabihf" "${pkgdir}/opt/alarm-x-tools-armv6h"

	rm -rf "${pkgdir}/opt/alarm-x-tools-armv6h/build.log.bz2"

	cd "${pkgdir}/opt/alarm-x-tools-armv6h/bin"
	for f in $(ls --ignore=arm-unknown-linux-gnueabihf-*)
	do
		rm "${f}"
	done
	for f in $(ls arm-unknown-linux-gnueabihf-*)
	do
		mv "${f}" "$(echo "${f}" | sed "s/^arm/armv6l/g")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	for f in *
	do
		ln -s "/opt/alarm-x-tools-armv6h/bin/$(basename "${f}")" "${pkgdir}/usr/bin/$(basename "${f}")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	install -Dm755 "${srcdir}/bin/xmake-armv6h" "${pkgdir}/usr/bin/"
	ln -s "xmake-armv6h" "${srcdir}/bin/make-armv6h"

	install -dm755 "${pkgdir}/usr/share/bash-completion/completions"
	install -Dm644 "${srcdir}/completions/xmake-armv6h" "${pkgdir}/usr/share/bash-completion/completions/"
}

package_x-tools-armv7h() {
	install -dm755 "${pkgdir}/opt"
	cp -ar "${srcdir}/x-tools7h/arm-unknown-linux-gnueabihf" "${pkgdir}/opt/alarm-x-tools-armv7h"

	rm -rf "${pkgdir}/opt/alarm-x-tools-armv7h/build.log.bz2"

	cd "${pkgdir}/opt/alarm-x-tools-armv7h/bin"
	for f in $(ls --ignore=arm-unknown-linux-gnueabihf-*)
	do
		rm "${f}"
	done
	for f in $(ls arm-unknown-linux-gnueabihf-*)
	do
		mv "${f}" "$(echo "${f}" | sed "s/^arm/armv7l/g")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	for f in *
	do
		ln -s "/opt/alarm-x-tools-armv7h/bin/$(basename "${f}")" "${pkgdir}/usr/bin/$(basename "${f}")"
	done

	install -dm755 "${pkgdir}/usr/bin"
	install -Dm755 "${srcdir}/bin/xmake-armv7h" "${pkgdir}/usr/bin/"
	ln -s "xmake-armv7h" "${srcdir}/bin/make-armv7h"

	install -dm755 "${pkgdir}/usr/share/bash-completion/completions"
	install -Dm644 "${srcdir}/completions/xmake-armv7h" "${pkgdir}/usr/share/bash-completion/completions/"
}
